{% extends 'dashboard/base.html' %}
{% load static %}
{% block title %}My Dashboard{% endblock title %}

{% block banner-slider %}
    <!-- ======= Sidebar ======= -->
    <aside id="sidebar" class="sidebar">
        <ul class="sidebar-nav" id="sidebar-nav">
            <li class="nav-item">
                <a class="nav-link active" href="#">
                    <i class="bi bi-grid"></i>
                    <span>Dashboard</span>
                </a>
            </li><!-- End Dashboard Nav -->

            <li class="nav-heading">Pages</li>

            <li class="nav-item">
                <a class="nav-link collapsed" href="{% url 'home' %}">
                    <i class="bi bi-person"></i>
                    <span>Home</span>
                </a>
            </li><!-- End Profile Page Nav -->
      
            <li class="nav-item">
                <a class="nav-link collapsed" href="{% url 'investment:investment_plans' %}">
                    <i class="bi bi-question-circle"></i>
                    <span>Invest</span>
                </a>
            </li><!-- End F.A.Q Page Nav -->
      
            <li class="nav-item">
                <a class="nav-link collapsed" href="{% url 'payment:withdraw' %}">
                    <i class="bi bi-card-list"></i>
                    <span>Withdraw</span>
                </a>
            </li><!-- End Register Page Nav -->
      
            <li class="nav-item">
                <a class="nav-link collapsed" href="{% url 'logout' %}">
                    <i class="bi bi-dash-circle"></i>
                    <span>Logout</span>
                </a>
            </li><!-- End Error 404 Page Nav -->
        </ul>
    </aside><!-- End Sidebar-->
{% endblock banner-slider %}

{% block main-content %}
<div class="container py-4">

  <div class="row g-4">
    <!-- CARD 1: Total Amount + Crypto Swiper + Action Buttons -->
    <div class="col-lg-6">
      <div class="card shadow-sm border-0 p-4 text-center">
        <h4 class="mb-3 text-muted">Total Account Value</h4>
        <h1 class="fw-bold text-success mb-3">${{ available_balance|floatformat:2 }}</h1>

        <!-- TradingView Ticker Widget -->
        <div class="tradingview-widget-container mb-4">
          <div class="tradingview-widget-container__widget"></div>
          <script type="text/javascript">
            new TradingView.widget({
              "symbols": [
                { "description": "Bitcoin", "proName": "BINANCE:BTCUSDT" },
                { "description": "Ethereum", "proName": "BINANCE:ETHUSDT" },
                { "description": "BNB", "proName": "BINANCE:BNBUSDT" },
                { "description": "Solana", "proName": "BINANCE:SOLUSDT" },
                { "description": "XRP", "proName": "BINANCE:XRPUSDT" }
              ],
              "colorTheme": "light",
              "isTransparent": false,
              "showSymbolLogo": true,
              "locale": "en"
            });
          </script>
          <script src="https://s3.tradingview.com/external-embedding/embed-widget-tickers.js"></script>
        </div>


        <div class="d-flex justify-content-around">
          <a href="{% url 'investment:investment_plans' %}" class="text-decoration-none">
            <i class="bi bi-wallet2 fs-2 text-primary"></i>
            <p class="mb-0">Deposit</p>
          </a>
          <a href="{% url 'investment:investment_plans' %}" class="text-decoration-none">
            <i class="bi bi-graph-up-arrow fs-2 text-success"></i>
            <p class="mb-0">Invest</p>
          </a>
          <a href="{% url 'payment:withdraw' %}" class="text-decoration-none">
            <i class="bi bi-cash-stack fs-2 text-warning"></i>
            <p class="mb-0">Withdraw</p>
          </a>
        </div>
      </div>
    </div>

    <!-- CARD 2: Available Balance -->
    <div class="col-lg-6">
      <div class="card shadow-sm border-0 p-4 text-center">
        <h5>Your Available Balance:</h5>
        {% if available_balance > 0 %}
          <h2 class="text-success">${{ available_balance|floatformat:2 }}</h2>
        {% else %}
          <p class="text-danger">
            Please <a href="#">fund your account</a>
          </p>
        {% endif %}
      </div>
    </div>

    <!-- CARD 3: Total Deposit & Withdraw -->
    <div class="col-lg-6">
      <div class="card shadow-sm border-0 p-4 text-center">
        <h5>Total Deposit: <span class="text-success">${{ total_deposit|floatformat:2 }}</span></h5>
        <h5>Total Withdrawn: <span class="text-danger">${{ total_withdrawn|floatformat:2 }}</span></h5>
      </div>
    </div>

    <!-- inside your 4th card (KYC) -->
    <div class="card shadow-sm border-0 p-4 text-center">
      {% if kyc_verified %}
        <h5 class="text-success">✅ KYC Verified</h5>
        <p>Your account is fully verified.</p>
      {% else %}
        <h5 class="text-warning">⚠️ KYC Required</h5>
        <a href="{% url 'kyc:verify' %}" class="btn btn-outline-primary">Verify Your Identity</a>
      {% endif %}

      <hr>

      <h6 class="mt-3">Your referral link</h6>
      <div class="input-group mt-2">
        <input type="text" class="form-control" id="refLink" value="{{ referral_url }}" readonly>
        <button class="btn btn-outline-secondary" id="copyRefBtn">Copy</button>
      </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function () {
      const btn = document.getElementById('copyRefBtn');
      if (btn) {
        btn.addEventListener('click', function () {
          const input = document.getElementById('refLink');
          input.select();
          navigator.clipboard.writeText(input.value).then(() => {
            btn.innerText = 'Copied!';
            setTimeout(()=> btn.innerText = 'Copy', 1500);
          });
        });
      }
    });
    </script>

  </div>

</div>
{% endblock %}
